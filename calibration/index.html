<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>D3: SVG bar chart with value labels (centered)</title>

		<script type="text/javascript" src="../lib/d3/d3.js"></script>
		<script type="text/javascript" src="../lib/jquery/jquery-2.1.0.min.js"></script>
		<script type="text/javascript" src="../utils.js"></script>
		<style type="text/css">
			/* No style rules here yet */		
		</style>
	</head>
	<body>
		<script type="text/javascript">
			calibration = new Object();
			calibration.server = 'localhost:8080';	
			calibration.w = window.innerWidth;
			calibration.h = window.innerHeight;
		  $(document).ready(function() {

    			
    			var time = setDuration(5);
    			url = 'http://'+calibration.server+'/lastseen?lastseen='+time;
    			console.log(url)
				
				$.ajax({
					dataType: 'jsonp',
					url: url,
					type: 'GET',
						success: function(postData) {
							// console.log(postData)
							
							// var json = JSON.parse(postData);
							// console.log(postData.length);
							var nodes = new Array();
							for (var i = 0; i < postData.length; i++) {
								var json = JSON.parse(postData[i])
								nodes.push(json)
								console.log(json);
							};
							calibration.data = nodes;
							initScreen();
						  
						},
						error: function(err) {
						  console.log("GET failed ");
						  console.log(err);
						}
				});
				
			});

		    var initScreen = function() {
			    calibration.svg = d3.select('body')
			    .append('svg:svg')
			    .attr('width', calibration.width)
			    .attr('height', calibration.height);

			        calibration.nodes = calibration.svg.selectAll('circle.node')
				    .data(calibration.data)
				    .enter()
				    .append('circle')
				    .attr('class', 'node')
				    .attr('cx', function(d,i) {
				    	  return i*20;
				      // return ( (d.x + i*10) < calibration.width ) ? (d.x +i*10) : 0;
				    })
				    .attr('cy', function(d,i) {
				      return 10 ;
				    })
				    .attr('r', function(d) {
				    	
				    	// console.log(json["kind"]);
				      return -d.power/10;
				    })
				    .attr('fill', function(d) {
				      return "red";
				    });
			}
		</script>
	</body>
</html>